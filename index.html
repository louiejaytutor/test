<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dane's To-Do List</title>
    <link rel="icon" href="static/img/icon.png">
    <link rel="apple-touch-icon" href="static/img/icon.png">
    <link rel="stylesheet" href='https://fonts.googleapis.com/css?family=Poppins'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="static/css/main.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>To-Do List</h1>
            <h5>18 Mar 2025, Tuesday</h5>
        </div>
        <div class="navigation">
            <button id="pending-btn" class="active">Undone</button>
            <button id="completed-btn">Completed</button>
            <button id="trash-btn">Trash</button>
        </div>
        <div id="tasks" class="tasks"></div>
    </div>
    <div class="add-task">
        <button><i class="fas fa-plus-circle"></i> Add new task</button>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-analytics.js";
        import {
            getFirestore, collection, getDocs, doc, query, orderBy, addDoc, serverTimestamp, getDoc, updateDoc, deleteDoc
        } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyACGoc6lsu92SIBil2oA-FEfVkAocIpe00",
            authDomain: "todo-list-c310f.firebaseapp.com",
            projectId: "todo-list-c310f",
            storageBucket: "todo-list-c310f.firebasestorage.app",
            messagingSenderId: "1954381734",
            appId: "1:1954381734:web:466c42e5ddbcea8dcd1967",
            measurementId: "G-2RK9RRWMC2"
        };
        
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);

        const tasks = document.getElementById("tasks");

        pendingTasks();

        function formatTimestamp(timestamp) {
            const date = timestamp.toDate();
            return date.toLocaleString("en-US", {
                month: "long",
                day: "numeric",
                year: "numeric",
                hour: "numeric",
                minute: "2-digit",
                second: "2-digit",
                hour12: true
            });
        }

        async function pendingTasks() {
            const querySnapshot = await getDocs(
                query(collection(db, "todo-list"), orderBy("timestamp", "asc"))
            );
            let hasPendingTasks = false;
            tasks.innerHTML = "";

            querySnapshot.forEach((doc) => {
                const data = doc.data();
                if (data.status == "pending") {
                    hasPendingTasks = true;

                    tasks.innerHTML = tasks.innerHTML + `<div class="task">
                        <div class="task-title">${data.task}</div>
                        <div class="task-timestamp">${formatTimestamp(data.timestamp)}</div>
                        <div class="task-action">
                            <button onclick="completeTask('${doc.id}')"><i class="fas fa-check-circle"></i></button>
                            <button onclick="editTask('${doc.id}')"><i class="fas fa-edit"></i></button>
                            <button onclick="removeTask('${doc.id}')"><i class="fas fa-trash-alt"></i></button>
                        </div>
                    </div>`;
                }
            });

            if (!hasPendingTasks || querySnapshot.empty) {
                tasks.innerHTML = `<div class="task">
                    <span class="no-task">No pending tasks.</span>
                </div>`;
            }
        }
    </script>
</body>
</html>